/**
 *
 * @copyright 2013 Raven Lagrimas
 *
 * rjlagrimas08@gmail.com
 * https://github.com/ravenjohn/simplexify
 */


(function(){'use strict';var Simplexify=Function.prototype;String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"").replace(/\s{2,}/g," ");};var unique=function(arr){var result=[],hash={},i,len;for (i=0,len=arr.length;i < len;i+= 1){if(!hash[arr[i]]){result.push(arr[i]);hash[arr[i]]=1;}}return result;};var toHash=function(arr){var obj={},i,len;for (i=0,len=arr.length;i < len;i+= 1){obj[arr[i]]=1;}return obj;};var same=function(obj1,obj2){var a,b,prop;if(obj1===obj2){return true;}if(!(obj1 instanceof obj2.constructor)){return false;}for (prop in obj1){if(!obj1.hasOwnProperty(prop)){continue;}a=obj1[prop];b=obj2[prop];if(typeof a==="object"){if(typeof a !== typeof b){return false;}if(!same(a,b)){return false;}}else{if(a.toString() !== b.toString()){return false;}}}return true;};var sortArrayWithSubsetAtEnd=function(arr,subset){var list=[],hash=toHash(subset),i,len;if(!subset||typeof subset !== "object"){return [];}for (i=0,len=arr.length;i < len;i++){if(!hash[arr[i]]){list.push(arr[i]);}}return list.sort().concat(subset.sort());};var Constraint=function(){this.comparison="";this.leftSide={};this.rightSide={};this.specialTerms={};return this;};Constraint.EPSILON=1e-6;Constraint.equals=function(obj){return same(this,obj);};Constraint.hasManyCompares=function(str){return 1 < (str.replace(/\s/g,"").match(/[<>]=?|=/g)||[]).length;};Constraint.hasIncompleteBinaryOperator=function(str){return /[+\-][><=+\-]|[><=+\-]$/.test(str.replace(/\s/g,""))||/[^+\-><=]\s+[^+\-><=]/.test(str.replace(/\s{2,}/g,""));};Constraint.validate=function(str){if(Constraint.hasManyCompares(str)){throw new Error("Only 1 comparison (<,>,=,>=,<=) is allowed in a Constraint.");}if(Constraint.hasIncompleteBinaryOperator(str)){throw new Error("Math operators must be in between terms. Good:(a+b=c). Bad:(a b+=c)");}};Constraint.switchSides=function(sideA,sideB,forEachTermFunc){forEachTermFunc.call(sideA,function(name,value){sideB.addTerm(name,-value);sideA.removeTerm(name);});};Constraint.prototype.getTermNames=function(excludeNumbers){return unique(([].concat(this.leftSide.getTermNames(excludeNumbers),this.rightSide.getTermNames(excludeNumbers))));};Constraint.parseToObject=function(str){str=str.replace(/([><])(\s+)(=)/g,"$1$3");Constraint.validate(str);var RE_comparison=/[><]=?|=/,arr=(""+str).split(RE_comparison),obj={rhs:Expression.parse("0"),comparison:"=",lhs:Expression.parse(arr[0])};if(1 < arr.length){obj.rhs=Expression.parse(arr[1]);obj.comparison=""+RE_comparison.exec(str);}return obj;};Constraint.parse=function(str){var obj=Constraint.parseToObject(str),e;if(obj){e=new Constraint();e.comparison=obj.comparison;e.leftSide=obj.lhs;e.rightSide=obj.rhs;}return e;};Constraint.prototype.toString=function(){return [this.leftSide,this.comparison,this.rightSide].join(" ");};Constraint.prototype.getSwappedSides=function(doSwap){return{a:(doSwap ? this.rightSide:this.leftSide),b:(doSwap ? this.leftSide:this.rightSide)};};Constraint.prototype.moveTypeToOneSide=function(varSide,numSide){var varSides,numSides;if(/left|right/.test(varSide)){varSides=this.getSwappedSides(/left/.test(varSide));Constraint.switchSides(varSides.a,varSides.b,varSides.a.forEachVariable);}if(/left|right/.test(numSide)){numSides=this.getSwappedSides(/left/.test(numSide));Constraint.switchSides(numSides.a,numSides.b,numSides.a.forEachConstant);}return this;};Constraint.prototype.inverse=function(){var oppositeCompare={"=":"=",">=":"<",">":"<=","<=":">","<":">="};if(oppositeCompare[this.comparison]){this.comparison=oppositeCompare[this.comparison];this.leftSide.inverse();this.rightSide.inverse();}return this;};Constraint.prototype.removeStrictInequality=function(){var eps;if(/^[<>]$/.test(this.comparison)){eps=Constraint.EPSILON * (">"===this.comparison ? 1:-1);this.rightSide.addTerm("1",eps);this.comparison+= "=";}return this;};Constraint.prototype.normalize=function(){this.moveTypeToOneSide("left","right");if(this.rightSide.getTermValue("1") < 0){this.inverse();}return this.removeStrictInequality();};Constraint.prototype.addSlack=function(val){this.setSpecialTerm({key:"slack",name:"slack",value:val});return this;};Constraint.prototype.setSpecialTerm=function(obj){if(!obj||typeof obj !== "object"||!obj.name||!obj.key){return this;}this.specialTerms[obj.key]=this.specialTerms[obj.key] ||{};var oldName=this.specialTerms[obj.key].name;if(oldName){if(typeof obj.value==="undefined"){obj.value=this.leftSide.getTermValue(oldName);}this.leftSide.removeTerm(oldName);}this.specialTerms[obj.key].name=obj.name;this.leftSide.setTerm(this.specialTerms[obj.key].name,+obj.value);return this;};Constraint.prototype.addartificialVariable=function(val){this.setSpecialTerm({key:"artificial",name:"artificial",value:val});return this;};Constraint.prototype.hasSpecialTerm=function(name){return !!this.specialTerms[name];};Constraint.prototype.renameSlack=function(name){this.setSpecialTerm({key:"slack",name:name});return this;};Constraint.prototype.renameArtificial=function(name){this.setSpecialTerm({key:"artificial",name:name});return this;};Constraint.prototype.convertToEquation=function(){this.normalize();switch (this.comparison){case "<=":this.addSlack(1);break;case ">=":this.addSlack(-1);this.addArtificialVariable(1);break;}this.comparison="=";return this;};Constraint.prototype.getSpecialTermNames=function(){var names=[];for (var prop in this.specialTerms){if(this.specialTerms.hasOwnProperty(prop) && this.specialTerms[prop]){names.push(this.specialTerms[prop].name);}}return names.length ? names:null;};Constraint.prototype.getSpecialTermValue=function(name){var obj=this.specialTerms[name];if(!obj){return null;}return this.getCoefficients([obj.name])[0];};Constraint.prototype.getArtificialName=function(){var obj=this.specialTerms.artificial;if(!obj){return null;}return obj.name;};Constraint.prototype.scale=function(factor){this.leftSide.scale(factor);this.rightSide.scale(factor);return this;};Constraint.prototype.varSwitchSide=function(name,moveTo){if(!/left|right/.test(moveTo)){return this;}name=(isNaN(name)) ? name:"1";var sideA=("left"===moveTo) ? this.rightSide:this.leftSide,sideB=("left" !== moveTo) ? this.rightSide:this.leftSide;if(sideA.hasTerm(name)){sideB.addTerm(name,-sideA.getTermValue(name));sideA.removeTerm(name);}return this;};Constraint.prototype.getCoefficients=function(termNames){if(!termNames){return null;}var arr=new Array(termNames.length),val,i=arr.length;while (i--){val=this.leftSide.getTermValue(termNames[i]);if(val===undefined){val=this.rightSide.getTermValue(termNames[i]);}arr[i]=val||0;}return arr;};Constraint.prototype.getTermValuesFromLeftSide=function(termNames){if(!termNames){return null;}var arr=new Array(termNames.length),val,i=arr.length;while (i--){val=this.leftSide.getTermValue(termNames[i]);if(val===undefined){val=-this.rightSide.getTermValue(termNames[i]);}arr[i]=val||0;}return arr;};var Input=function(){this.z=null;this.type=null;this.terms=null;this.constraints=null;this.isStandardMode=false;};Input.parse=function(type,z,constraints){Input.validate(type,z,constraints);var obj=new Input();obj.type=type;obj.z=Expression.parse(z);obj.constraints=Input.getArrOfConstraints(constraints);obj.setTermNames();obj.checkConstraints();return obj;};Input.getArrOfConstraints=function(arr){arr=(Matrix.isArray(arr)) ? arr:[arr];var constraints=[],i=arr.length;while (i--){constraints[i]=Constraint.parse(arr[i]);}return constraints;};Input.validate=function(type,z,constraints){if(typeof z !== "string"){throw new Error("z must be a string.");}if(type !== "maximize" && type !== "minimize"){throw new Error("`maximize` and `minimize` are the only types that is currently supported.");}if(!Matrix.isArray(constraints)||!constraints.length){throw new Error("Constraints must be an array with at least one element.");}};Input.prototype.doAnyConstrainsHaveRelation=function(comparison){if(!comparison){return false;}comparison=new RegExp(comparison);return this.anyConstraints(function(i,constraint){return comparison.test(constraint.comparison);});};Input.prototype.doAllConstrainsHaveRelation=function(comparison){comparison=new RegExp(comparison);return this.allConstraints(function(i,constraint){return comparison.test(constraint.comparison);});};Input.prototype.anyConstraints=function(fn){for (var i=0,len=this.constraints.length;i < len;i++){if(fn(i,this.constraints[i],this.constraints)){return true;}}return false;};Input.prototype.allConstraints=function(fn){var result=true;for (var i=0,len=this.constraints.length;i < len;i++){result=result && !!fn(i,this.constraints[i],this.constraints);}return result;};Input.prototype.forEachConstraint=function(fn){for (var i=0,len=this.constraints.length;i < len;i++){fn(i,this.constraints[i],this.constraints);}};Input.prototype.getAllArtificialNames=function(){var names=[];this.forEachConstraint(function(i,constraint){var name=constraint.getArtificialName();if(name){names.push(name);}});return names;};Input.prototype.addNumbersToSpecialTerms=function(){var c=this.constraints,slackI=1,artificialI=1;for (var i=0,len=c.length;i < len;i++){if(c[i].hasSpecialTerm("slack")){c[i].renameSlack("slack"+slackI);slackI++;}if(c[i].hasSpecialTerm("artificial")){c[i].renameArtificial("artificial"+artificialI);artificialI++;}}};Input.prototype.getTermNames=function(onlyVariables){var vars=[],i=this.constraints.length;while (i--){vars=vars.concat(this.constraints[i].getTermNames(onlyVariables));}return unique(vars).sort();};Input.prototype.getAllSpecialTermNames=function(){var names=[];this.forEachConstraint(function(i,constraint){names=names.concat( constraint.getSpecialTermNames());});return names;};Input.prototype.setTermNames=function(){this.terms=this.getTermNames();};Input.prototype.getZTermNotInAnyOfTheConstraints=function(){var varMissing="",terms=this.z.getTermNames(),term,i=0,iLen=terms.length;for (;!varMissing && i < iLen;i++){term=terms[i];for (var j=0,jLen=this.constraints.length;j < jLen;j++){if(this.constraints[j].leftSide.terms[term]){break;}}if(j===jLen){varMissing=term;}}return varMissing;};Input.prototype.checkConstraints=function(){var errMsg=[],missingZVar=this.getZTermNotInAnyOfTheConstraints();if(missingZVar){errMsg.push("`"+missingZVar+"`,from the objective function,should appear least once in a constraint.");}return errMsg;};Input.prototype.toString=function(){return [this.type+" z="+this.z,"where "+this.constraints.join(",")].join(",");};Input.prototype.convertConstraintsToMaxForm=function(){var c=this.constraints;for (var i=0,len=c.length;i < len;i++){c[i]=c[i].convertToEquation();}};Input.prototype.convertToStandardForm=function(){if(this.isStandardMode){return this;}this.convertConstraintsToMaxForm();this.addNumbersToSpecialTerms();this.setTermNames();this.isStandardMode=true;return this;};var Expression=function(){this.terms={};};Expression.parse=function(str){var obj=new Expression();if(typeof str !== "string"||!str.length){return obj;}Expression.validate(str);obj.terms=Expression.convertExpressionToObject(Expression.addSpaceBetweenTerms(str));return obj;};Expression.encodeE=function(str){return str.replace(/(\de)([+])(\d)/gi,"$1_plus_$3").replace(/(\de)([\-])(\d)/gi,"$1_sub_$3");};Expression.decodeE=function(str){return str.replace(/_plus_/g,"+").replace(/_sub_/g,"-");};Expression.addSpaceBetweenTerms=function(str){return Expression.decodeE(Expression.encodeE(str).replace(/([\+\-])/g," $1 ").trim());};Expression.hasExcludedOperations=function(str){return (/[\*\/%]/).test(str);};Expression.hasIncompleteBinaryOperator=function(str){var hasError,noSpaceStr=(""+str).replace(/\s/g,""),RE_hasNoPlusOrMinus=/^[^\+\-]+$/,RE_noLeftAndRightTerms=/[\+\-]{2}|[\+\-]$/,hasMoreThanOneTerm=/\S+\s+\S+/.test(str);hasError=hasMoreThanOneTerm && RE_hasNoPlusOrMinus.test(noSpaceStr);hasError=hasError||RE_noLeftAndRightTerms.test(noSpaceStr);return hasError;};Expression.hasComparison=function(str){return (/[><=]/).test(str);};Expression.validate=function(str){if(Expression.hasComparison(str)){throw new Error("Comparison are not allowed within an expression.");}if(Expression.hasExcludedOperations(str)){throw new Error("Sorry but we only support addition and subtraction.");}if(Expression.hasIncompleteBinaryOperator(str)){throw new Error("Exactly one math operators must be between terms.\n Good:(a+b). Bad:(a+- b+).");}};Expression.extractComponentsFromVariable=function(str){str=""+str;var re=/^[\+\-]?\d+(\.\d+)?(e[\+\-]?\d+)?/i,coeff=""+(str.match(re)||[""])[0],term=str.replace(re,'')||1;if(+str===0){coeff=0;}if(coeff===""){coeff=/^\-/.test(term) ? -1:1;term=term.replace(/^[\+\-]/,"");}return [+coeff,term];};Expression.splitStrByTerms=function(str){return (""+str).replace(/^\+/,"").replace(/([\+\-])\s+/g,"$1").split(/\s+[\+]?/);};Expression.convertExpressionToObject=function(str){var term,obj={},matches=Expression.splitStrByTerms((str||"").trim()),i=matches.length;while (i--){term=Expression.extractComponentsFromVariable(matches[i]);obj[term[1]]=(obj[term[1]]) ? (obj[term[1]])+term[0]:term[0];}return obj;};Expression.termAtIndex=function(i,name,value){return (value ? ((value < 0) ? (value == -1 ? "-":value):((i ? "+":"")+(value == 1 ? "":value))):(0 < name && i ? "+":""))+name;};Expression.prototype.getTermNames=function(excludeNumbers,excludeSlack){var obj=this.terms,terms=[],key;for (key in obj){if(!obj.hasOwnProperty(key)||(excludeSlack && /^slack\d*$/i.test(key))){continue;}if(isNaN(key)){terms.push(key);}}terms=terms.sort();if(!excludeNumbers && obj && obj[1]){terms.push(obj[1].toString());}return terms;};Expression.prototype.forEachTerm=function(fn){if(typeof fn !== "function"){return;}for (var prop in this.terms){if(this.terms.hasOwnProperty(prop)){fn(prop,this.terms[prop],this.terms);}}};Expression.prototype.forEachConstant=function(fn){if(typeof fn !== "function"){return;}var prop="1";if(this.terms[prop]){fn(prop,this.terms[prop],this.terms);}};Expression.prototype.forEachVariable=function(fn){if(typeof fn !== "function"){return;}for (var prop in this.terms){if(this.terms.hasOwnProperty(prop) && prop !== "1"){fn(prop,this.terms[prop],this.terms);}}};Expression.prototype.toString=function(){var arr=[],names=this.getTermNames(),i,name,len,func=Expression.termAtIndex;if(!names.length){return "0";}for (i=0,len=names.length;i < len;i++){name=names[i];arr.push(func(i,name,this.terms[name]));}return arr.join(" ").replace(/\s[\+\-]/g,"$& ");};Expression.prototype.inverse=function(){this.forEachTerm(function(termName,value,terms){terms[termName]=-value;});return this;};Expression.prototype.addTerm=function(name,value){if(typeof value !== "undefined"){value+= this.terms[name]||0;if(value){this.terms[name]=value;}else{this.removeTerm(name);}}else{this.addExpression(name);}return this;};Expression.prototype.setTerm=function(name,value){if(value){this.terms[name]=value;}else{this.removeTerm(name);}return this;};Expression.prototype.addExpression=function(obj){if(!(obj instanceof Expression)){obj=Expression.parse(obj);}this.addTerms(obj.toTermValueArray());return this;};Expression.prototype.toTermValueArray=function(){var arr=[];for (var name in this.terms){if(this.terms.hasOwnProperty(name)){arr.push([name,this.terms[name]]);}}return arr;};Expression.prototype.addTerms=function(arr){if(!arr||typeof arr !== "object"){return this;}for (var i=0,len=arr.length;i < len;i++){if(arr[i] && typeof arr[i]==="object"){this.addTerm(arr[i][0],arr[i][1]);}}return this;};Expression.prototype.removeTerm=function(name){delete this.terms[name];return this;};Expression.prototype.scale=function(factor){this.forEachTerm(function(name,value,terms){terms[name]=(factor * value);});return this;};Expression.prototype.hasTerm=function(name){return !!this.terms[name];};Expression.prototype.getTermValue=function(name){return this.terms[name];};Expression.prototype.getAllCoeffients=function(excludeNumbers,excludeSlack){var arr=[],names=this.getTermNames(excludeNumbers,excludeSlack);for (var i=0,len=names.length;i < len;i++){arr.push(+(this.terms[names[i]]||names[i]));}return arr;};Expression.prototype.getCoefficients=function(termNames){var arr=[],i=termNames.length;while (i--){arr[i]=this.terms[termNames[i]]||0;}return arr;};var Simplex=function(){this.input=new root.Input();this.tableau=new root.Tableau();this.output="";this.state=null;};Simplex.validate=function(obj){if(typeof obj !== "object"){throw new Error("An object must be passed to Simplexify.solve()");}if(!obj.type||!obj.objective||!obj.constraints){throw new Error("The object must have the properties `type`,`objective` and `constraints`.");}};var Matrix=function(){this.array=[];};Matrix.isArray=function(obj){return Object.prototype.toString.call(obj)==="[object Array]";};Matrix.parse=function(input){var obj=new Matrix(),isArray=Matrix.isArray(input);if(input !== undefined && !(isArray && !input.length)){if(isArray && Matrix.isArray(input[0])){obj.array=input;}else{input=isArray ? input:[input];obj.addRow(input);}}return obj;};Matrix.scaleRow=function(scale,row){if(!Matrix.isArray(row)){return row;}row=row.concat();for (var i=0,len=row.length;i < len;i++){row[i] *= scale;}return row;};Matrix.addRows=function(rowA,rowB){return Matrix.scaleThenAddRows(1,rowA,1,rowB);};Matrix.scaleThenAddRows=function(scaleA,rowA,scaleB,rowB){rowA=(Matrix.isArray(rowA)) ? rowA.concat():[];rowB=(Matrix.isArray(rowB)) ? rowB.concat():[];var len=Math.max(rowA.length,rowB.length);for (var i=0;i < len;i++){rowA[i]=(scaleA * (rowA[i]||0))+(scaleB * (rowB[i]||0));}return rowA;};Matrix.inverseArray=function(arr){if(!Matrix.isArray(arr)){return arr;}var i=arr.length;while (i--){arr[i]=-arr[i];}return arr;};Matrix.transpose=function(arr){if(!Matrix.isArray(arr)||!arr.length||!Matrix.isArray(arr[0])){return null;}var result=[],iLen=arr.length,info=Matrix.getMaxArray(arr),jLen=info ? info.max:0;for (var i=0;i < jLen;i++){result[i]=[];for (var j=0;j < iLen;j++){result[i][j]=arr[j][i];}}return result;};Matrix.getGreatestElementInRow=function(arr,excludeIndex,findPositive){if(!arr||!Matrix.isArray(arr)){return null;}var obj={value:Infinity * (findPositive ? -1:1),index:-1};for (var i=0,len=arr.length;i < len;i++){if(excludeIndex===i){continue;}if((findPositive && obj.value < arr[i])||(!findPositive && arr[i] < obj.value)){obj.index=i;obj.value=arr[i];}}return obj;};Matrix.prototype.addRow=function(arr){arr=Matrix.isArray(arr) ? arr:[arr];this.array.push(arr);return this;};Matrix.prototype.transpose=function(){this.array=Matrix.transpose(this.array);return this;};Matrix.prototype.equals=function(obj){return obj && obj instanceof Matrix && this.toString()===obj.toString();};Matrix.prototype.getElement=function(i,j){return this.array[i][j];};Matrix.prototype.getColumn=function(j){var arr=[];this.forEachRow(function(i,row){arr.push(row[j]);});return arr;};Matrix.prototype.getRow=function(i){return this.array[i];};Matrix.prototype.get=function(row,col){if(!col && col !== 0){return this.getRow(row);}else if(row||row===0){return this.getElement(row,col);}else{return this.getColumn(col);}};Matrix.prototype.forEachRow=function(fn){if(typeof fn==="function"){for (var i=0,len=this.array.length;i < len;i++){fn(i,this.array[i],this.array);}}return this;};Matrix.prototype.replaceEachRow=function(fn){var newRow;if(typeof fn==="function"){for (var i=0,len=this.array.length;i < len;i++){newRow=fn(i,this.array[i],this.array);if(newRow && Matrix.isArray(newRow)){this.array[i]=newRow;newRow=null;}}}return this;};Matrix.prototype.toArray=function(){return this.array;};Matrix.prototype.getGreatestValueFromLastRow=function(isPositive){if(!this.array||this.array.length < 1){return -1;}var row=this.array[this.array.length - 1];var obj=Matrix.getGreatestElementInRow(row,row.length - 1,!!isPositive);if(isPositive){return -1 < obj.value ? obj.index:-1;}else{return obj.value < 0 ? obj.index:-1;}};Matrix.prototype.getRowIndexWithPosMinColumnRatio=function(colI,excludeLastRow){var obj={rowIndex:-1,minValue:Infinity},len=this.array.length+(excludeLastRow ? -1:0),val,row;if(colI < 0||this.array[0].length <= colI){return null;}for (var i=0;i < len;i++){row=this.array[i];val=row[row.length - 1] / row[colI];if(0 <= val && val < obj.minValue){obj.rowIndex=i;obj.minValue=val;}}return obj;};Matrix.prototype.setUniformedWidth=function(){var info=Matrix.getMaxArray(this.array);for (var i=0,len=this.array.length;i < len;i++){this.array[i].length=info.max;}return this;};Matrix.prototype.toString=function(){var str="";this.forEachRow(function(i,row){if(i){str+= ",";}str+= "["+row.toString()+"]";});str="["+str+"]";return str;};Matrix.prototype.getSize=function(){var columns=0,rows=this.array.length,i=rows,x;while (i--){x=this.array[i].length;columns=columns < x ? x:columns;}return [columns,rows];};Matrix.prototype.scaleRow=function(scaleA,rowI){var row=this.array[rowI]||[];for (var i=0,len=row.length;i < len;i++){row[i] *= scaleA;}return this;};Matrix.prototype.addToRow=function(iRow,els){if(this.array[iRow]){this.array[iRow]=(this.array[iRow]||[]).concat(els);}else{this.addRow(els);}return this;};Matrix.getMaxArray=function(arrays){var obj={index:0,max:0};if(!Matrix.isArray(arrays)){return null;}if(!Matrix.isArray(arrays[0])){obj.max=arrays.length;return obj;}var i=arrays.length;while (i--){if(obj.max < arrays[i].length){obj.index=i;obj.max=arrays[i].length;}}return obj;};Matrix.prototype.pivot=function(rowI,colI){if(!this.array[rowI]){return this;}var x=this.getElement(rowI,colI),val,pRow;this.scaleRow(1 / x,rowI);pRow=this.array[rowI];for (var i=0,len=this.array.length;i < len;i++){if(i===rowI){continue;}val=this.getElement(i,colI);this.array[i]=Matrix.scaleThenAddRows(-val,pRow,1,this.array[i]);}return this;};Matrix.prototype.getUnitValueForColumn=function(colI){var nonZeroValues=0,val=0;this.forEachRow(function(i,row){if(row[colI]===1){val=row[row.length - 1];}if(row[colI]){nonZeroValues++;}});val=(nonZeroValues===1) ? val:0;return val;};Matrix.prototype.getLastElementOnLastRow=function(){var row=this.array[this.array.length - 1];return row[row.length - 1];};var Tableau=function(){this.input=null;this.colNames=null;this.matrix=null;this.limit=1e4;this.cycles=0;};Tableau.validate=function(input){if(!(input instanceof Input)){throw new Error("Must pass an instance of the Input class.");}};Tableau.parse=function(input){var obj=new Tableau();Tableau.validate(input);obj.input=input.convertToStandardForm();obj.setMatrixFromInput();return obj;};Tableau.getPivotPoint=function(matrix,isMin){if(!(matrix instanceof Matrix)){return null;}var point={};point.column=matrix.getGreatestValueFromLastRow(!!isMin);var obj=matrix.getRowIndexWithPosMinColumnRatio(point.column,true) ||{};point.row=obj.rowIndex;if(point.column < 0||point.row < 0){return null;}return point;};Tableau.prototype.addConstraintsToMatrix=function(termNames){var constraints=this.input.constraints;for (var i=0,len=constraints.length;i < len;i++){this.matrix.addRow(constraints[i].getCoefficients(termNames));}};Tableau.prototype.getSortedTermNames=function(){var termNames=this.input.getTermNames(true),specialNames=this.input.getAllSpecialTermNames();return sortArrayWithSubsetAtEnd(termNames,specialNames);};Tableau.prototype.addZToMatrix=function(termNames){var b=Constraint.parse("0="+this.input.z.toString());b.moveTypeToOneSide("left","right");var row=b.leftSide.getCoefficients(termNames);row=row.concat(b.rightSide.getTermValue("1")||0);this.matrix.addRow(row);};Tableau.prototype.setMatrixFromInput=function(){this.matrix=new Matrix();this.colNames=this.getSortedTermNames();this.addConstraintsToMatrix(this.colNames.concat("1"));this.addZToMatrix(this.colNames);};Tableau.prototype.toString=function(){var result="";if(this.matrix){result+= "["+this.colNames.concat("Constant").toString()+"],";result+= this.matrix.toString();}return result;};Tableau.prototype.solve=function(isMin){var getPoint=Tableau.getPivotPoint,point=getPoint(this.matrix,isMin),limit=this.limit;while (point && limit--){this.matrix.pivot(point.row,point.column);point=getPoint(this.matrix,isMin);this.cycles++;}return this;};Tableau.prototype.getOutput=function(){var obj={},names=this.colNames.concat();for (var i=0,len=names.length;i < len;i++){obj[names[i]]=this.matrix.getUnitValueForColumn(i);}obj.z=this.matrix.getLastElementOnLastRow();return JSON.stringify(obj);};Simplexify.solve=function(input){Simplex.validate(input);return Tableau.parse( Input.parse(input.type,input.objective,input.constraints)).solve().getOutput();};window.Simplexify=Simplexify;}());